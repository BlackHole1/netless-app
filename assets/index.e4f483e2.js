import{S as T,i as J,s as K,e as _,b as c,F as I,d as A,g,o as E,l as V,m as S,G as D,t as C,h as O,c as U,D as q,B as L,H as M}from"./vendor.e2f737fd.js";var B="assets/pencil.614cc8ea.svg",N="assets/pencil-off.f49ce2a4.svg",Q="assets/plus.4b34cdbf.svg",R="assets/close.c4eb3b01.svg",X="assets/up.c9e084a4.svg";function W(e,l,t){const n=e.slice();return n[16]=l[t],n[17]=l,n[18]=t,n}function j(e){let l,t,n,u,a,o;return{c(){l=_("button"),t=_("img"),c(t,"draggable","false"),I(t.src,n=Q)||c(t,"src",n),c(t,"alt","add"),c(l,"title","Add"),l.disabled=u=e[1].length>=20},m(i,p){A(i,l,p),g(l,t),a||(o=E(l,"click",e[7]),a=!0)},p(i,p){p&2&&u!==(u=i[1].length>=20)&&(l.disabled=u)},d(i){i&&V(l),a=!1,o()}}}function z(e){let l,t,n,u,a;return{c(){l=_("button"),t=_("img"),c(t,"draggable","false"),I(t.src,n=e[4]?N:B)||c(t,"src",n),c(t,"alt","edit"),c(l,"title","Edit")},m(o,i){A(o,l,i),g(l,t),u||(a=E(l,"click",e[5]),u=!0)},p(o,i){i&16&&!I(t.src,n=o[4]?N:B)&&c(t,"src",n)},d(o){o&&V(l),u=!1,a()}}}function F(e){let l,t,n=(e[2][e[18]]||0)+"",u,a,o,i,p,h,d,m;function k(){return e[12](e[18])}return{c(){l=_("span"),t=C("("),u=C(n),a=C(")"),o=S(),i=_("button"),p=_("img"),c(l,"class","netless-app-vote-count"),c(p,"draggable","false"),I(p.src,h=X)||c(p,"src",h),c(p,"alt","vote"),c(i,"title","Vote")},m(r,b){A(r,l,b),g(l,t),g(l,u),g(l,a),A(r,o,b),A(r,i,b),g(i,p),d||(m=E(i,"click",k),d=!0)},p(r,b){e=r,b&4&&n!==(n=(e[2][e[18]]||0)+"")&&O(u,n)},d(r){r&&V(l),r&&V(o),r&&V(i),d=!1,m()}}}function H(e){let l,t,n,u,a;function o(){return e[13](e[18])}return{c(){l=_("button"),t=_("img"),c(t,"draggable","false"),I(t.src,n=R)||c(t,"src",n),c(t,"alt","delete"),c(l,"title","Delete")},m(i,p){A(i,l,p),g(l,t),u||(a=E(l,"click",o),u=!0)},p(i,p){e=i},d(i){i&&V(l),u=!1,a()}}}function P(e){let l,t,n,u,a,o,i,p;function h(){e[11].call(t,e[17],e[18])}let d=!e[4]&&F(e),m=e[4]&&H(e);return{c(){l=_("li"),t=_("input"),u=S(),d&&d.c(),a=S(),m&&m.c(),o=S(),c(t,"class","netless-app-vote-item"),t.readOnly=n=!e[4]},m(k,r){A(k,l,r),g(l,t),D(t,e[16]),g(l,u),d&&d.m(l,null),g(l,a),m&&m.m(l,null),g(l,o),i||(p=E(t,"input",h),i=!0)},p(k,r){e=k,r&16&&n!==(n=!e[4])&&(t.readOnly=n),r&2&&t.value!==e[16]&&D(t,e[16]),e[4]?d&&(d.d(1),d=null):d?d.p(e,r):(d=F(e),d.c(),d.m(l,a)),e[4]?m?m.p(e,r):(m=H(e),m.c(),m.m(l,o)):m&&(m.d(1),m=null)},d(k){k&&V(l),d&&d.d(),m&&m.d(),i=!1,p()}}}function Y(e){let l,t,n,u,a,o,i=(e[0]||"what to eat")+"",p,h,d,m,k,r=e[4]&&j(e),b=e[3]&&z(e),y=e[1],v=[];for(let f=0;f<y.length;f+=1)v[f]=P(W(e,y,f));return{c(){l=_("div"),t=_("div"),r&&r.c(),n=S(),b&&b.c(),u=S(),a=_("div"),o=_("h2"),p=C(i),h=S(),d=_("ul");for(let f=0;f<v.length;f+=1)v[f].c();c(t,"class","netless-app-vote-controls"),c(o,"contenteditable",e[4]),U(o,"editing",e[4]),c(a,"class","netless-app-vote-title"),c(d,"class","netless-app-vote-items"),c(l,"class","netless-app-vote"),c(l,"data-kind","vote")},m(f,w){A(f,l,w),g(l,t),r&&r.m(t,null),g(t,n),b&&b.m(t,null),g(l,u),g(l,a),g(a,o),g(o,p),g(l,h),g(l,d);for(let s=0;s<v.length;s+=1)v[s].m(d,null);m||(k=E(o,"input",e[6]),m=!0)},p(f,[w]){if(f[4]?r?r.p(f,w):(r=j(f),r.c(),r.m(t,n)):r&&(r.d(1),r=null),f[3]?b?b.p(f,w):(b=z(f),b.c(),b.m(t,null)):b&&(b.d(1),b=null),w&1&&i!==(i=(f[0]||"what to eat")+"")&&O(p,i),w&16&&c(o,"contenteditable",f[4]),w&16&&U(o,"editing",f[4]),w&790){y=f[1];let s;for(s=0;s<y.length;s+=1){const G=W(f,y,s);v[s]?v[s].p(G,w):(v[s]=P(G),v[s].c(),v[s].m(d,null))}for(;s<v.length;s+=1)v[s].d(1);v.length=y.length}},i:q,o:q,d(f){f&&V(l),r&&r.d(),b&&b.d(),L(v,f),m=!1,k()}}}function Z(e,l,t){let n;const u=M();let{writable:a=!1}=l,{title:o=""}=l,{items:i=["lorem","ipsum","dolo","sit","amet"]}=l,{votes:p=[0,0,0,0,0]}=l,h="vote";function d(){t(10,h=n?"vote":"edit"),h==="vote"&&(t(2,p=Array(i.length).fill(0)),b())}function m(s){t(0,o=s.target.textContent||"")}function k(){t(1,i=i.concat([""]))}function r(s){t(1,i=i.slice(0,s).concat(i.slice(s+1)))}function b(){a&&(p.forEach((s,G)=>{u("update",{votes:[G,s]})}),u("update",{title:o,items:i}))}function y(s){a&&u("update",{votes:[s,p[s]+1]})}function v(s,G){s[G]=this.value,t(1,i)}const f=s=>y(s),w=s=>r(s);return e.$$set=s=>{"writable"in s&&t(3,a=s.writable),"title"in s&&t(0,o=s.title),"items"in s&&t(1,i=s.items),"votes"in s&&t(2,p=s.votes)},e.$$.update=()=>{e.$$.dirty&1024&&t(4,n=h==="edit")},[o,i,p,a,n,d,m,k,r,y,h,v,f,w]}class x extends T{constructor(l){super();J(this,l,Z,Y,K,{writable:3,title:0,items:1,votes:2})}}var $=`.netless-app-vote{width:100%;height:100%;background-color:#fff;display:flex;flex-flow:column nowrap}.netless-app-vote [contenteditable=true]{border-bottom:1px dashed #ccc}.netless-app-vote button{height:25px;gap:4px;background-color:transparent;border:2px solid transparent;border-radius:4px}.netless-app-vote button:hover{border-color:#ccc}.netless-app-vote button:active{background-color:#ccc}.netless-app-vote button img{width:16px;height:16px}.netless-app-vote-controls{position:absolute;top:8px;right:8px}.netless-app-vote-title{padding:8px}.netless-app-vote-title h2{margin:0;padding:2px 8px;display:inline-block;line-height:1.1;color:#333;border-bottom:1px dashed transparent}.netless-app-vote-items{flex-grow:1;margin:0;padding:0 8px 12px;list-style-type:none;overflow-y:auto}.netless-app-vote-items li{display:flex;align-items:center;gap:5px;line-height:1.5;padding-bottom:4px}.netless-app-vote-items li button{display:inline-block}.netless-app-vote-item{display:block;font-size:16px;line-height:1.5;font-family:Arial,sans-serif;flex-grow:1;border:1px solid #eee;border-radius:4px;padding:2px 8px}.netless-app-vote-item[readonly]{border-color:transparent}.netless-app-vote-count{padding-right:8px}
`;const te={kind:"Vote",setup(e){const l=e.getBox();let t=e.getAttributes();if(t||(e.setAttributes({title:"",items:[]}),t=e.getAttributes()),!t){e.emitter.emit("destroy",{error:new Error("[NetlessAppVote] No attributes")});return}t.title==null&&e.updateAttributes(["title"],""),t.items||e.updateAttributes(["items"],[]),l.mountStyles($);const n=new x({target:l.$content,props:{writable:e.getIsWritable()}});e.emitter.on("writableChange",()=>{n.$set({writable:e.getIsWritable()})}),n.$on("update",({detail:a})=>{if("title"in a&&e.updateAttributes(["title"],a.title),"items"in a&&e.updateAttributes(["items"],a.items),Array.isArray(a.votes)){const[o,i]=a.votes;e.updateAttributes([`item-${o}`],i)}});const u=[e.mobxUtils.autorun(()=>{n.$set({title:t.title})}),e.mobxUtils.autorun(()=>{t.items&&n.$set({items:[...t.items]})}),e.mobxUtils.autorun(()=>{t.items&&n.$set({votes:t.items.map((a,o)=>t[`item-${o}`]||0)})})];e.emitter.on("destroy",()=>{u.forEach(a=>a()),n.$destroy()})}};export{te as default};
