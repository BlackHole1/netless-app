(()=>{(function(q){"use strict";self.onmessage=e=>{const{id:n,path:t,error:r}=e.data;postMessage({id:n,curves:X(t,r)})};/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */const R=Object.freeze({x:0,y:0});function k(e,n){return Math.sqrt((e.x-n.x)**2+(e.y-n.y)**2)}function g(e){return Math.sqrt(e.x**2+e.y**2)}function B(e){return e.x**2+e.y**2}function h(e,n){return{x:e.x+n.x,y:e.y+n.y}}function L(...e){return{x:e.reduce((n,t)=>n+t.x,0),y:e.reduce((n,t)=>n+t.y,0)}}function a(e,n){return{x:e.x-n.x,y:e.y-n.y}}function i(e,n){return{x:e.x*n,y:e.y*n}}function w(e,n){return{x:e.x/n,y:e.y/n}}function Q(e){const n=g(e);return n===0?e:w(e,n)}function C(e,n){return e.x*n.x+e.y*n.y}function X(e,n){if(e.length<2)return[];const t=e.length,r=O(e[1],e[0]),c=O(e[t-2],e[t-1]);return A(e,r,c,n)}function A(e,n,t,r){const c=20;if(e.length===2){const m=k(e[0],e[1])/3;return[[e[0],h(e[0],i(n,m)),h(e[1],i(t,m)),e[1]]]}const u=V(e);let[o,f,s]=j(e,u,u,n,t);if(f===0||f<r)return[o];if(f<r*r){let m=u,v=f,_=s;for(let M=0;M<c;M++){if(m=I(o,e,m),[o,f,s]=j(e,u,m,n,t),f<r)return[o];if(s===_){const l=f/v;if(l>.9999&&l<1.0001)break}v=f,_=s}}const x=[];let d=a(e[s-1],e[s+1]);if(d.x===0&&d.y===0){const{x:m,y:v}=a(e[s-1],e[s]);d={x:-v,y:m}}const N=Q(d),D=i(N,-1);return x.push(...A(e.slice(0,s+1),n,N,r)),x.push(...A(e.slice(s),D,t,r)),x}function j(e,n,t,r,c){const u=F(e,t,r,c),[o,f]=G(e,u,n);return[u,o,f]}function F(e,n,t,r){const c=e[0],u=e[e.length-1],o=[c,R,R,u],f=n.map(l=>{const b=1-l;return[i(t,3*l*(b*b)),i(r,3*b*(l*l))]}),s=[[0,0],[0,0]],x=[0,0];for(const[l,b]of n.entries()){const[y,z]=f[l];s[0][0]+=C(y,y),s[0][1]+=C(y,z),s[1][0]+=C(y,z),s[1][1]+=C(z,z);const U=a(e[l],E([c,c,u,u],b));x[0]+=C(y,U),x[1]+=C(z,U)}const d=s[0][0]*s[1][1]-s[1][0]*s[0][1],N=s[0][0]*x[1]-s[1][0]*x[0],D=x[0]*s[1][1]-x[1]*s[0][1],m=d===0?0:D/d,v=d===0?0:N/d,_=g(a(c,u)),M=1e-6*_;return m<M||v<M?(o[1]=h(c,i(t,_/3)),o[2]=h(u,i(r,_/3))):(o[1]=h(c,i(t,m)),o[2]=h(u,i(r,v))),o}function I(e,n,t){return t.map((r,c)=>S(e,n[c],r))}function S(e,n,t){const r=a(E(e,t),n),c=K(e,t),u=C(r,c),o=B(c)+2*C(r,P(e,t));return o===0?t:t-u/o}function V(e){let n=[],t,r,c;return e.forEach((u,o)=>{t=o>0?r+g(a(u,c)):0,n.push(t),r=t,c=u}),n=n.map(u=>u/r),n}function G(e,n,t){let r=0,c=Math.floor(e.length/2);const u=H(n,10);for(let o=1;o<e.length-1;o++){const f=e[o],s=J(n,t[o],u,10),x=a(E(n,s),f),d=B(x);d>r&&(r=d,c=o)}return[r,c]}function H(e,n){let t=[0],r=e[0],c=0;for(let u=1;u<=n;u++){const o=E(e,u/n);c+=g(a(o,r)),t.push(c),r=o}return t=t.map(u=>u/c),t}function J(e,n,t,r){if(n<0)return 0;if(n>1)return 1;for(let c=1;c<=r;c++)if(n<=t[c]){const u=(c-1)/r,o=c/r,f=t[c-1],s=t[c];return(n-f)/(s-f)*(o-u)+u}return Number.NaN}function O(e,n){return Q(a(e,n))}function E(e,n){const t=1-n,r=i(e[0],t**3),c=i(e[1],3*t**2*n),u=i(e[2],3*t*n**2),o=i(e[3],n**3);return L(r,c,u,o)}function K(e,n){const t=1-n,r=i(a(e[1],e[0]),3*t**2),c=i(a(e[2],e[1]),6*t*n),u=i(a(e[3],e[2]),3*n**2);return L(r,c,u)}function P(e,n){return h(i(h(a(e[2],i(e[1],2)),e[0]),6*(1-n)),i(h(a(e[3],i(e[2],2)),e[1]),6*n))}return q.fitCurve=X,Object.defineProperty(q,"__esModule",{value:!0}),q})({});})();
